<div class="ac-page account-type-page">
  <div class="ac-card">
    <!-- HEADER -->
    <div class="ac-page-header account-type-header">
      <div>
        <div class="ac-page-title">Debtor Type Maintenance</div>
        <div class="ac-page-subtitle">Maintain debtor types used across modules.</div>
      </div>

      <div class="account-type-toolbar">
        <input
          class="account-type-search"
          type="text"
          placeholder="Search type / description..."
          [(ngModel)]="q"
          (input)="page = 1"
        />

        <button class="ac-btn ac-btn-primary" (click)="onNew()">New</button>
        <button class="ac-btn" [disabled]="!selected" (click)="onEdit()">Edit</button>
        <button class="ac-btn ac-btn-danger" [disabled]="!selected" (click)="onDelete()">Delete</button>
      </div>
    </div>

    <!-- GRID -->
    <div class="account-type-grid">
      <table class="ac-table">
        <thead>
          <tr>
            <th style="width: 160px">Debtor Type</th>
            <th>Description</th>
            <th>2nd Description</th>
            <th style="width:120px">Active</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let r of filteredRows() | slice : (page - 1) * pageSize : (page - 1) * pageSize + pageSize; trackBy: trackByType" (click)="selected = r" [class.ac-row-selected]="selected === r">
            <td class="mono">{{ r.typeCode }}</td>
            <td class="clip" [title]="r.description">{{ r.description }}</td>
            <td class="clip" [title]="r.description2nd">{{ r.description2nd || '-' }}</td>
            <td>
              <span [ngClass]="r.active === 'Yes' ? 'ac-badge-blue' : 'ac-badge-grey'">{{ r.active }}</span>
            </td>
          </tr>
          <tr *ngIf="(filteredRows() || []).length === 0">
            <td class="empty" colspan="4">No data</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- FOOTER / PAGER -->
    <div class="account-type-footer">
      <div class="account-type-rec">Records: {{ filteredRows().length }}</div>

      <div class="account-type-pager">
        <button class="ac-btn ac-btn-ghost account-type-pg-btn" [disabled]="page === 1" (click)="page = 1">&laquo;</button>
        <button class="ac-btn ac-btn-ghost account-type-pg-btn" [disabled]="page === 1" (click)="page = page - 1">&lsaquo;</button>

        <span class="account-type-pg-label">Page {{ page }} / {{ pageCount() }}</span>

        <button class="ac-btn ac-btn-ghost account-type-pg-btn" [disabled]="page === pageCount()" (click)="page = page + 1">&rsaquo;</button>
        <button class="ac-btn ac-btn-ghost account-type-pg-btn" [disabled]="page === pageCount()" (click)="page = pageCount()">&raquo;</button>
      </div>
    </div>
  </div>
</div>

<!-- DIALOGS -->
<div class="ac-dialog-backdrop" *ngIf="showModal">
  <div class="ac-card-no-padding ac-dialog-panel-lg">
    <div class="ac-dialog-header">
      <span>{{ isEdit ? 'Edit Debtor Type' : 'New Debtor Type' }}</span>
      <button type="button" class="ac-dialog-close" (click)="closeModal()">×</button>
    </div>
    <div class="ac-dialog-body">
      <div class="ac-dialog-form-grid-2">
        <label class="ac-form-field">
          <span class="ac-form-label">Debtor Type</span>
          <input class="inp mono" [(ngModel)]="form.typeCode" [readOnly]="isEdit" placeholder="e.g. BK" />
        </label>
        <label class="ac-form-field">
          <span class="ac-form-label">Description</span>
          <input class="inp" [(ngModel)]="form.description" />
        </label>
        <label class="ac-form-field">
          <span class="ac-form-label">2nd Description</span>
          <input class="inp" [(ngModel)]="form.description2nd" />
        </label>
        <label class="ac-form-field">
          <span class="ac-form-label">Active</span>
          <select class="inp" [(ngModel)]="form.active">
            <option value="Yes">Yes</option>
            <option value="No">No</option>
          </select>
        </label>
      </div>
    </div>
    <div class="ac-dialog-footer">
      <button class="ac-btn ac-btn-ghost" (click)="closeModal()">Cancel</button>
      <button class="ac-btn ac-btn-primary" (click)="save()">Save</button>
    </div>
  </div>
</div>

<div class="ac-dialog-backdrop" *ngIf="showDeleteConfirm">
  <div class="ac-card-no-padding ac-dialog-panel-sm" role="dialog" aria-modal="true">
    <div class="ac-dialog-header">
      <span>Delete Debtor Type</span>
      <button type="button" class="ac-dialog-close" (click)="closeDeleteConfirm()">×</button>
    </div>
    <div class="ac-dialog-body">
      <p>Are you sure you want to delete <b>{{ selected?.typeCode }}</b>?</p>
    </div>
    <div class="ac-dialog-footer">
      <button class="ac-btn ac-btn-ghost" (click)="closeDeleteConfirm()">Cancel</button>
      <button class="ac-btn ac-btn-danger" (click)="confirmDelete()">Delete</button>
    </div>
  </div>
</div>

<div class="ac-dialog-backdrop" *ngIf="showSuccess">
  <div class="ac-card-no-padding ac-dialog-panel-sm" role="dialog" aria-modal="true">
    <div class="ac-dialog-header" style="background: linear-gradient(180deg,#9be28a 0%, #62c84f 100%);">
      <span>Success</span>
      <button type="button" class="ac-dialog-close" (click)="closeSuccess()">×</button>
    </div>
    <div class="ac-dialog-body">
      <p style="margin:8px 0; font-weight:600; color:#14532d">{{ successMsg }}</p>
    </div>
    <div class="ac-dialog-footer">
      <button class="ac-btn ac-btn-primary" (click)="closeSuccess()">OK</button>
    </div>
  </div>
</div>
