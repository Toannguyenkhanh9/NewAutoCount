<div class="ac-page">
  <ng-container *ngIf="!showForm">
    <div class="ac-card">
      <!-- ============ HEADER ============ -->
      <div class="ac-page-header">
        <div>
          <div class="ac-page-title">A/R Invoice Entry</div>
          <div class="ac-page-subtitle">
            Record and manage sales invoices and their payment history.
          </div>
        </div>

        <div class="ac-page-toolbar" role="toolbar">
          <input class="ac-form-control ac-page-search" type="text" [(ngModel)]="q"
            placeholder="Search invoice no / company name..." />

          <button type="button" class="ac-btn ac-btn-primary" (click)="newInvoice()">
            <span class="ico plus"></span>
            New
          </button>

          <button type="button" class="ac-btn" [disabled]="!selected" (click)="editInvoice()">
            <span class="ico edit"></span>
            Edit
          </button>

          <button type="button" class="ac-btn ac-btn-danger" [disabled]="!selected"
            (click)="openDeleteInvoiceConfirm()">
            <span class="ico trash"></span>
            Delete
          </button>
        </div>
      </div>

      <!-- ============ LIST + HISTORY ============ -->
      <div class="list-shell">
        <!-- Main grid -->
        <div class="ac-card ac-card-no-padding main-grid">
          <div class="ac-tablewrap">
            <table class="ac-table">
              <thead>
                <tr>
                  <th class="ac-text-left" (click)="setSort('docDate')">Invoice No</th>
                  <th class="ac-text-left" (click)="setSort('docNo')">Date</th>
                  <th class="ac-text-left" (click)="setSort('debtor')">Company Name</th>
                  <th class="ac-text-left">Description</th>
                  <th class="ac-text-right">Total</th>
                  <th class="ac-text-right">Outstanding</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let inv of paged" (click)="toggleSelect(inv)" [class.ac-row-selected]="selected === inv"
                  [class.ac-row-overdue]="isOverdue(inv)">
                  <td>{{ inv.docNo }}</td>
                  <td>{{ inv.docDate }}</td>
                  <td>{{ inv.debtor }} â€” {{ inv.debtorName }}</td>
                  <td>{{ inv.description || '-' }}</td>
                  <td class="ac-text-right">
                    {{ inv.grandTotal | number : '1.2-2' }}
                  </td>
                  <td class="ac-text-right">
                    {{ inv.outstanding | number : '1.2-2' }}
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Payment history -->
        <div class="ac-card ac-card-no-padding payment-panel" *ngIf="selected">
          <div class="pp-head">
            <div class="pp-title">
              Payment History
              <ng-container *ngIf="selected">
                &nbsp;â€”&nbsp;<b>{{ selected.docNo }}</b>
              </ng-container>
            </div>
          </div>

          <div class="pp-body" *ngIf="selected; else noSel">
            <div class="ac-tablewrap">
              <table class="ac-table ac-table-sm">
                <colgroup>
                  <col style="width: 12%" />
                  <col style="width: 20%" />
                  <col style="width: 42%" />
                  <col style="width: 13%" />
                  <col style="width: 13%" />
                </colgroup>
                <thead>
                  <tr>
                    <th class="ac-text-left" style="width: 90px">Type</th>
                    <th class="ac-text-left" style="width: 120px">No.</th>
                    <th class="ac-text-left">Description</th>
                    <th class="ac-text-left" style="width: 120px">Date</th>
                    <th class="ac-text-right" style="width: 140px">Amount</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let p of paymentHistory">
                    <td>{{ p.type }}</td>
                    <td>{{ p.no }}</td>
                    <td class="cut">{{ p.description || '-' }}</td>
                    <td>{{ p.date }}</td>
                    <td class="ac-text-right">
                      {{ p.amount | number : '1.2-2' }}
                    </td>
                  </tr>
                  <tr *ngIf="!paymentHistory.length">
                    <td colspan="5" class="ac-text-center ac-text-muted">
                      â€” No payment â€”
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <ng-template #noSel>
            <div class="pp-empty">
              Select an invoice to see its payment history.
            </div>
          </ng-template>
        </div>
      </div>

      <!-- ============ PAGER ============ -->
    <div class="account-type-footer">
      <div class="account-type-rec">
        Total Records: {{ filtered.length }}
      </div>

      <div class="account-type-pager">
        <button
          class="ac-btn ac-btn-ghost account-type-pg-btn"
          [disabled]="page === 1"
          (click)="page = 1"
        >
          &laquo;
        </button>
        <button
          class="ac-btn ac-btn-ghost account-type-pg-btn"
          [disabled]="page === 1"
          (click)="page = page - 1"
        >
          &lsaquo;
        </button>

        <span class="account-type-pg-label">
          Page {{ page }} / {{ 1 }}
        </span>

        <button
          class="ac-btn ac-btn-ghost account-type-pg-btn"
          [disabled]="page === 1"
          (click)="page = page + 1"
        >
          &rsaquo;
        </button>
        <button
          class="ac-btn ac-btn-ghost account-type-pg-btn"
          [disabled]="page === 1"
          (click)="page = 1"
        >
          &raquo;
        </button>
      </div>
    </div>
    </div>
  </ng-container>
  <!-- ================== MODALS ================== -->

  <!-- INVOICE FORM (New/Edit/View) -->
  <ng-container *ngIf="showForm">
    <div class="inv-form">
      <!-- top title (giá»‘ng Debtor) -->
      <div class="inv-header">
        <div>
          <h2 class="inv-title">
            {{
            formMode === 'new'
            ? 'New A/R Invoice'
            : formMode === 'edit'
            ? 'Edit A/R Invoice'
            : 'View A/R Invoice'
            }}
            <ng-container *ngIf="formMode !== 'new' && invForm?.value?.docNo">
              &nbsp;â€”&nbsp;{{ invForm.value.docNo }}
            </ng-container>
          </h2>
          <p class="inv-subtitle">
            Record and manage sales invoices and their payment history.
          </p>
        </div>
      </div>

      <!-- BODY: header fields + lines -->
      <form [formGroup]="invForm" class="inv-body">
        <div class="inv-body-inner">
          <!-- ==== HEADER GRID (giá»‘ng Xero) ==== -->
          <div class="inv-header-grid">
            <!-- Contact -->
            <label class="inv-field inv-field-contact">
              <span class="inv-label">Contact</span>

              <div class="inv-contact-input ac-input-prefix-group">
                <!-- icon ngÆ°á»i -->
                <span class="ac-input-prefix-icon"><lucide-icon name="user" [size]="15"
                    color="#111827"></lucide-icon></span>

                <select class="ac-form-control" formControlName="debtor" (change)="onDebtorChanged()">
                  <option value="">Select debtor...</option>
                  <option *ngFor="let d of debtors" [ngValue]="d.debtorAccount">
                    {{ d.debtorAccount }} â€” {{ d.companyName }}
                  </option>
                </select>

                <!-- nÃºt search bÃªn pháº£i -->
                <button type="button" class="inv-contact-search" (click)="openDebtorDropdown()" title="Search debtors"
                  aria-label="Search debtors">
                  <lucide-icon name="search" [size]="15" color="#111827"></lucide-icon>
                </button>
              </div>

              <div class="inv-error" *ngIf="isInvalid('debtor')">
                Please select a debtor.
              </div>
            </label>
            <!-- Invoice number -->
            <label class="inv-field">
              <span class="inv-label">Invoice number</span>
              <div class="ac-input-prefix-group">
                <span class="ac-input-prefix-icon"><lucide-icon name="hash" [size]="15"
                    color="#111827"></lucide-icon></span>
                <input class="ac-form-control" formControlName="docNo"
                  [readonly]="invForm.value.autoNumbering || formMode !== 'new'" placeholder="&lt;&lt;new&gt;&gt;"
                  [class.invalid]="isInvalid('docNo')" />
              </div>
              <div class="inv-error" *ngIf="isInvalid('docNo')">
                <ng-container *ngIf="invForm.get('docNo')?.errors?.['pattern']">
                  Only letters, numbers, '-', '_' and '/' are allowed.
                </ng-container>
                <ng-container *ngIf="invForm.get('docNo')?.errors?.['duplicate']">
                  This invoice number already exists.
                </ng-container>
              </div>
            </label>

            <!-- Reference -->
            <label class="inv-field">
              <span class="inv-label">Reference</span>
              <div class="ac-input-prefix-group">
                <span class="ac-input-prefix-icon"><lucide-icon name="hash" [size]="15"
                    color="#0c0c0c"></lucide-icon></span>
                <input class="ac-form-control" formControlName="ref2" [readonly]="formMode === 'view'" />
              </div>
            </label>
            <!-- Issue date -->
            <label class="inv-field">
              <span class="inv-label">Issue date</span>
              <div class="ac-input-prefix-group">
                <span class="ac-input-prefix-icon"><lucide-icon name="calendar" [size]="15"
                    color="#111827"></lucide-icon></span>
                <input type="date" class="ac-form-control" formControlName="docDate" (change)="recalcDue()"
                  [readonly]="formMode === 'view'" />
              </div>
            </label>
            <!-- Due date + quick options -->
            <label class="inv-field inv-field-due">
              <span class="inv-label">Due date</span>
              <div class="ac-input-prefix-group">
                <div class="inv-due-input">
                  <span class="ac-input-prefix-icon"><lucide-icon name="calendar" [size]="15"
                      color="#111827"></lucide-icon></span>
                  <!-- Bá»Ž readonly cá»‘ Ä‘á»‹nh, chá»‰ readonly khi view -->
                  <input style="padding-left: 32px;" type="date" class="ac-form-control" formControlName="dueDate"
                    [readonly]="formMode === 'view'" />

                  <!-- nÃºt má»Ÿ menu ngÃ y nhanh -->
                  <button type="button" class="inv-due-shortcut-btn" (click)="toggleDueShortcuts($event)"
                    aria-label="Quick due date">
                    â‹¯
                  </button>
                </div>
              </div>
              <!-- menu cÃ¡c lá»±a chá»n ngÃ y nhanh -->
              <div class="inv-due-shortcuts" *ngIf="showDueShortcuts" (click)="$event.stopPropagation()">
                <button type="button" (click)="applyDueShortcut('IN_7')">In 7 days</button>
                <button type="button" (click)="applyDueShortcut('IN_14')">In 14 days</button>
                <button type="button" (click)="applyDueShortcut('FIRST_NEXT')">
                  1st of next month
                </button>
                <button type="button" (click)="applyDueShortcut('TWENTIETH_NEXT')">
                  20th of next month
                </button>
                <button type="button" (click)="applyDueShortcut('END_NEXT')">
                  End of next month
                </button>

                <button type="button" class="reset" (click)="applyDueShortcut('RESET')">
                  Reset to default due date
                </button>
              </div>
            </label>

            <!-- Journal type -->
            <label class="inv-field">
              <span class="inv-label">Journal type</span>
              <div class="inv-contact-input ac-input-prefix-group">
                <!-- icon ngÆ°á»i -->
                <span class="ac-input-prefix-icon"><lucide-icon name="user" [size]="15"
                    color="#111827"></lucide-icon></span>

                <select class="ac-form-control" formControlName="journalType" [disabled]="formMode === 'view'">
                  <option *ngFor="let j of journalTypes" [ngValue]="j.typeCode">
                    {{ j.typeCode }}
                  </option>
                </select>
              </div>

            </label>

            <!-- Currency -->
            <label class="currency-field">
              <span class="inv-label" style="font-weight: 600;">Currency</span>

              <div class="ac-input-prefix-group">
                <!-- cháº¥m trÃ²n nhá» giá»‘ng Xero -->
                <span class="ac-input-prefix-icon ac-input-prefix-dot"></span>

                <!-- trigger nhÃ¬n nhÆ° 1 Ã´ input -->
                <div class="currency-trigger ac-form-control">
                  <!-- <div class="currency-trigger ac-form-control" (click)="toggleCurrencyPanel()"> -->
                  <div class="currency-trigger-main">
                    <span class="currency-trigger-label">
                      <ng-container *ngIf="selectedCurrency; else noCurrency">
                        {{ selectedCurrency?.name || selectedCurrency?.code }}
                        <span *ngIf="selectedCurrency?.isDefault">
                          (default)
                        </span>
                      </ng-container>

                      <ng-template #noCurrency>
                        Select currency
                      </ng-template>
                    </span>

                    <span class="currency-trigger-code" *ngIf="selectedCurrency?.code">
                      {{ selectedCurrency?.code }}
                    </span>
                  </div>

                  <span class="currency-arrow">â–¾</span>
                </div>

                <!-- PANEL DROPDOWN -->
                <div class="currency-panel" *ngIf="showCurrencyPanel" (click)="$event.stopPropagation()">
                  <!-- SEARCH BOX -->
                  <div class="currency-search-row">
                    <span class="currency-search-icon"> <lucide-icon name="search" [size]="15"
                        color="#111827"></lucide-icon></span>
                    <input type="text" [(ngModel)]="currencySearch" (input)="filterCurrencies()"
                      placeholder="Search currency" />
                  </div>

                  <!-- MY CURRENCIES -->
                  <div class="currency-group" *ngIf="myCurrencies?.length">
                    <div class="currency-group-title">My currencies</div>

                    <button type="button" class="currency-row" *ngFor="let c of myCurrencies"
                      (click)="selectCurrency(c)">
                      <span class="currency-name">
                        {{ c.name || c.code }}
                        <span *ngIf="c.isDefault">(default)</span>
                      </span>
                      <span class="currency-code">{{ c.code }}</span>
                    </button>
                  </div>

                  <!-- ALL CURRENCIES -->
                  <div class="currency-group">
                    <div class="currency-group-title">All currencies</div>

                    <button type="button" class="currency-row" *ngFor="let c of filteredCurrencies"
                      (click)="selectCurrency(c)">
                      <span class="currency-name">
                        {{ c.name || c.code }}
                      </span>
                      <span class="currency-code">{{ c.code }}</span>
                    </button>
                  </div>
                </div>
              </div>
            </label>
          </div>

          <br>
          <!-- ==== TO BOX ==== -->
          <div class="inv-to-box">
            <div class="to-title">To: </div>
            <textarea class="to-text" rows="3" readonly [value]="debtorToText"></textarea>
          </div>
          <br>
          <!-- ==== LINES SECTION ==== -->
          <div class="inv-lines">
            <div class="inv-lines-tablewrap">
              <table class="ac-table-addnew inv-lines-table">
                <thead>
                  <tr>
                    <th style="width: 220px">Sales A/C</th>
                    <th style="width: 120px">To Acc. Rate</th>
                    <th>Description</th>
                    <th class="ac-text-right" style="width: 160px">Amount</th>
                    <th style="width: 44px"></th>
                  </tr>
                </thead>
                <tbody *ngIf="invForm">
                  <tr *ngFor="
              let fg of acLineGroups;
              let i = index;
              trackBy: trackByIndex
            " [formGroup]="fg">
                    <td>
                      <input class="ac-form-control" formControlName="accNo" [attr.list]="'accnos-' + i"
                        (focus)="prepAccNoSuggestions(i)" (input)="prepAccNoSuggestions(i)"
                        [readonly]="formMode === 'view'" />
                      <datalist [id]="'accnos-' + i">
                        <option *ngFor="let s of accNoSugs[i]" [value]="s"></option>
                      </datalist>
                    </td>

                    <td class="ac-text-right">
                      <input type="number" step="0.0001" class="ac-form-control" formControlName="toAccRate"
                        (input)="recalcLine(i)" [readonly]="formMode === 'view'" />
                    </td>

                    <td>
                      <input class="ac-form-control" formControlName="lineDesc" [readonly]="formMode === 'view'" />
                    </td>

                    <td class="ac-text-right">
                      <input class="ac-form-control" appAmount formControlName="amount" [allowNegative]="false"
                        (input)="recalcTotals()" [readonly]="formMode === 'view'" />
                    </td>

                    <td class="ac-text-center inv-line-remove">
                      <button type="button" class="ac-btn ac-btn-icon-danger" (click)="removeAcLine(i)"
                        [disabled]="formMode === 'view'">
                        ðŸ—‘
                      </button>
                    </td>
                  </tr>

                  <tr *ngIf="!acLineGroups.length">
                    <td colspan="5" class="ac-text-center ac-text-muted">
                      No lines
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- BOTTOM: Add row (trÃ¡i) + Totals (pháº£i) -->
            <div class="inv-lines-bottom">
              <!-- Add row dropdown -->
              <div class="inv-addrow-wrapper" *ngIf="formMode !== 'view'">
                <div class="inv-addrow-split" [class.open]="showAddRowMenu">
                  <!-- nÃºt chÃ­nh: thÃªm 1 dÃ²ng -->
                  <button type="button" class="ac-btn ac-btn-primary inv-addrow-main" (click)="addRows(1)">
                    Add row
                  </button>

                  <!-- nÃºt caret má»Ÿ menu -->
                  <button type="button" class="ac-btn ac-btn-primary inv-addrow-caret" (click)="toggleAddRowMenu()">
                    â–¾
                  </button>

                  <!-- menu chá»n sá»‘ dÃ²ng -->
                  <div class="inv-addrow-menu" *ngIf="showAddRowMenu">
                    <button type="button" class="inv-addrow-menu-item" (click)="addRows(5); closeAddRowMenu()">
                      Add 5 rows
                    </button>
                    <button type="button" class="inv-addrow-menu-item" (click)="addRows(10); closeAddRowMenu()">
                      Add 10 rows
                    </button>
                    <button type="button" class="inv-addrow-menu-item" (click)="addRows(20); closeAddRowMenu()">
                      Add 20 rows
                    </button>
                  </div>
                </div>
              </div>

              <!-- Totals giá»¯ nguyÃªn bÃªn pháº£i -->
              <div class="inv-totals">
                <div class="row">
                  <div class="label">Total</div>
                  <div class="value">
                    {{ invForm.value.grandTotal | number : '1.2-2' }}
                  </div>
                </div>
                <div class="ac-amount-summary-divider-main"></div>
                <div class="row total">
                  <div class="label">Net Total</div>
                  <div class="value">
                    {{ invForm.value.grandTotal | number : '1.2-2' }}
                  </div>
                </div>
                <div class="row total">
                  <div class="label">Outstanding</div>
                  <div class="value">
                    {{ invForm.value.outstanding | number : '1.2-2' }}
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>

        <!-- FOOTER STICKY -->
        <div class="inv-footer">
          <label class="chk">
            <input type="checkbox" formControlName="continueNew" />
            <span>After save, proceed with new debit note entry</span>
          </label>
          <button type="button" class="ac-btn ac-btn-ghost" (click)="closeForm()">
            Cancel
          </button>
          <button *ngIf="formMode !== 'view'" type="button" class="ac-btn ac-btn-primary" (click)="saveInvoice()"
            [disabled]="invForm.invalid">
            {{
            formMode === 'new'
            ? 'Create'
            : 'Save'
            }}
          </button>
        </div>
      </form>
    </div>
  </ng-container>


  <!-- FIND dialog -->
  <div class="dialog" *ngIf="showFind">
    <div class="dialog-panel ac-card-no-padding ac-dialog-panel-lg">
      <div class="ac-dialog-header">
        <span>Find Invoice</span>
        <button class="ac-dialog-close" type="button" (click)="showFind = false" aria-label="Close">
          âœ•
        </button>
      </div>

      <div class="ac-dialog-body">
        <form [formGroup]="findForm" class="grid3">
          <label>
            From
            <input type="date" class="ac-form-control" formControlName="from" />
          </label>
          <label>
            To
            <input type="date" class="ac-form-control" formControlName="to" />
          </label>
          <label>
            Debtor
            <select class="ac-form-control" formControlName="debtor">
              <option value="">Any</option>
              <option *ngFor="let d of debtors" [value]="d.debtorAccount">
                {{ d.debtorAccount }} â€” {{ d.companyName }}
              </option>
            </select>
          </label>
          <label>
            Status
            <select class="ac-form-control" formControlName="status">
              <option value="all">All</option>
              <option>OPEN</option>
              <option>POSTED</option>
              <option>VOID</option>
            </select>
          </label>
          <label>
            Min Amount
            <input type="number" step="0.01" class="ac-form-control" formControlName="min" />
          </label>
          <label>
            Max Amount
            <input type="number" step="0.01" class="ac-form-control" formControlName="max" />
          </label>
        </form>

        <div class="ac-dialog-footer">
          <button type="button" class="ac-btn ac-btn-primary" (click)="runFind()">
            Search
          </button>
        </div>

        <div class="ac-tablewrap" *ngIf="findResults.length">
          <table class="ac-table ac-table-sm">
            <thead>
              <tr>
                <th>Date</th>
                <th>Doc No</th>
                <th>Debtor</th>
                <th class="r">Total</th>
                <th>Status</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let r of findResults">
                <td>{{ r.docDate }}</td>
                <td>{{ r.docNo }}</td>
                <td>{{ r.debtor }} â€” {{ r.debtorName }}</td>
                <td class="r">{{ r.grandTotal | number : "1.2-2" }}</td>
                <td>
                  <button class="btn btn-primary" (click)="pickFromFind(r)">
                    Select
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- PRINT LISTING -->
  <div class="dialog" *ngIf="showPrint">
    <div class="dialog-panel ac-card-no-padding ac-dialog-panel-lg">
      <div class="ac-dialog-header">
        <span>A/R Invoice Listing</span>
        <button class="ac-dialog-close" type="button" (click)="showPrint = false" aria-label="Close">
          âœ•
        </button>
      </div>

      <div class="ac-dialog-body">
        <form [formGroup]="printForm" class="grid4">
          <label>
            From
            <input type="date" class="ac-form-control" formControlName="from" />
          </label>
          <label>
            To
            <input type="date" class="ac-form-control" formControlName="to" />
          </label>
          <label>
            Debtor
            <select class="ac-form-control" formControlName="debtor">
              <option value="">Any</option>
              <option *ngFor="let d of debtors" [value]="d.debtorAccount">
                {{ d.debtorAccount }} â€” {{ d.companyName }}
              </option>
            </select>
          </label>
          <label>
            Status
            <select class="ac-form-control" formControlName="status">
              <option value="all">All</option>
              <option>OPEN</option>
              <option>POSTED</option>
              <option>VOID</option>
            </select>
          </label>
          <label>
            Sort by
            <select class="ac-form-control" formControlName="sort">
              <option value="docDate">Date</option>
              <option value="docNo">Doc No</option>
              <option value="debtor">Debtor</option>
              <option value="grandTotal">Amount</option>
            </select>
          </label>
        </form>

        <div class="ac-dialog-footer">
          <button type="button" class="ac-btn ac-btn-primary" (click)="showPreview = true">
            Preview
          </button>
        </div>

        <div class="preview" *ngIf="showPreview">
          <h3>A/R Invoice Listing (Preview)</h3>
          <div class="ac-tablewrap">
            <table class="ac-table ac-table-sm">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Doc No</th>
                  <th>Debtor</th>
                  <th class="ac-text-right">Sub Total</th>
                  <th class="ac-text-right">Tax</th>
                  <th class="ac-text-right">Total</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let x of buildListing()">
                  <td>{{ x.docDate }}</td>
                  <td>{{ x.docNo }}</td>
                  <td>{{ x.debtor }} â€” {{ x.debtorName }}</td>
                  <td class="ac-text-right">
                    {{ x.subTotal | number : '1.2-2' }}
                  </td>
                  <td class="ac-text-right">
                    {{ x.taxTotal | number : '1.2-2' }}
                  </td>
                  <td class="ac-text-right">
                    {{ x.grandTotal | number : '1.2-2' }}
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- DEBTOR PICKER -->
  <div class="dialog" *ngIf="showDebtorPicker">
    <div class="dialog-panel ac-card-no-padding ac-dialog-panel-lg">
      <div class="ac-dialog-header">
        <span>Select Debtor</span>
        <button class="ac-dialog-close" type="button" (click)="showDebtorPicker = false">
          Ã—
        </button>
      </div>
      <div class="ac-dialog-body">
        <div class="ac-page-toolbar" style="padding: 0 0 8px 0; gap: 8px; display: flex">
          <input class="ac-form-control ac-page-search" [(ngModel)]="debtorQuery" (ngModelChange)="filterDebtors()"
            placeholder="Search Debtor A/C, Company Name..." />
        </div>
        <div class="ac-tablewrap">
          <table class="ac-table ac-table-sm">
            <thead>
              <tr>
                <th>Debtor A/C</th>
                <th>Company Name</th>
                <th>Bill Address</th>
                <th>Phone</th>
                <th style="width: 90px"></th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let d of debtorFiltered" (dblclick)="pickDebtor(d)">
                <td>{{ d.debtorAccount }}</td>
                <td>{{ d.companyName }}</td>
                <td class="cut">{{ d.billAddress }}</td>
                <td>{{ d.phone }}</td>
                <td>
                  <button type="button" class="ac-btn ac-btn-primary" (click)="pickDebtor(d)">
                    Select
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- DELETE INVOICE CONFIRM -->
  <div class="ac-dialog-backdrop" *ngIf="showDeleteInvoiceConfirm">
    <div class="ac-card-no-padding ac-dialog-panel-sm" role="dialog" aria-modal="true" style="min-width: 360px">
      <div class="ac-dialog-header">
        <span>Delete Invoice</span>
        <button class="ac-dialog-close" type="button" (click)="closeDeleteInvoiceConfirm()" aria-label="Close">
          Ã—
        </button>
      </div>

      <div class="ac-dialog-body">
        <p>
          Are you sure you want to delete
          <b>{{ selected?.docNo || 'this invoice' }}</b>?
        </p>
      </div>

      <div class="ac-dialog-footer">
        <button type="button" class="ac-btn ac-btn-ghost" (click)="closeDeleteInvoiceConfirm()">
          Cancel
        </button>
        <button type="button" class="ac-btn ac-btn-danger" (click)="confirmDeleteInvoice()">
          Delete
        </button>
      </div>
    </div>
  </div>

  <!-- SUCCESS POPUP -->
  <div class="ac-dialog-backdrop" *ngIf="showSuccess">
    <div class="ac-card-no-padding ac-dialog-panel-sm ac-dialog-success" role="dialog" aria-modal="true"
      style="min-width: 360px">
      <div class="ac-dialog-header ac-dialog-success-header">
        <span>Success</span>
        <button class="ac-dialog-close" type="button" (click)="closeSuccess()" aria-label="Close">
          Ã—
        </button>
      </div>
      <div class="ac-dialog-body">
        <p class="ac-dialog-success-text">
          {{ successMsg }}
        </p>
      </div>
      <div class="ac-dialog-footer">
        <button type="button" class="ac-btn ac-btn-primary" (click)="closeSuccess()">
          OK
        </button>
      </div>
    </div>
  </div>
</div>
